<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Inscription · Université Centrale</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    </head>
    <body class="auth-page">
        <div class="auth-container fade-up">
            <div class="auth-header">
                <span class="badge">Espace étudiant</span>
                <h1>Créer un compte</h1>
                <p>Rejoignez la communauté universitaire en quelques secondes</p>
            </div>

            <form id="signup-form" class="auth-form">
                <div class="form-group">
                    <label for="name" class="form-label">Nom complet</label>
                    <input
                        type="text"
                        id="name"
                        name="name"
                        class="form-input"
                        required
                        placeholder="Votre nom complet"
                        autocomplete="name"
                    />
                </div>
                <div class="form-group">
                    <label for="email" class="form-label">Adresse e-mail</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-input"
                        required
                        placeholder="votre@email.com"
                        autocomplete="email"
                    />
                </div>
                <div class="form-group">
                    <label for="password" class="form-label">Mot de passe</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        class="form-input"
                        required
                        minlength="8"
                        placeholder="Au moins 8 caractères"
                        autocomplete="new-password"
                    />
                </div>
                <div class="form-group">
                    <label for="confirm-password" class="form-label"
                        >Confirmez le mot de passe</label
                    >
                    <input
                        type="password"
                        id="confirm-password"
                        name="confirm-password"
                        class="form-input"
                        required
                        minlength="8"
                        placeholder="Confirmez votre mot de passe"
                        autocomplete="new-password"
                    />
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    Créer mon compte
                </button>
            </form>

            <div class="form-alert error" id="error-message"></div>
            <div class="form-alert success" id="success-message"></div>

            <div class="auth-footer">
                <span>Déjà inscrit&nbsp;?</span>
                <a href="login.html">Se connecter</a>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.1"></script>
        <script src="auth.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                auth.redirectIfNeeded("signup.html", "profile.html");

                const signupForm = document.getElementById("signup-form");
                const errorMessage = document.getElementById("error-message");
                const successMessage = document.getElementById("success-message");

                const showAlert = (element, message) => {
                    if (!element) return;
                    element.textContent = message;
                    element.classList.add("is-visible");
                };

                const hideAlert = (element) => {
                    if (!element) return;
                    element.classList.remove("is-visible");
                    element.textContent = "";
                };

                signupForm.addEventListener("submit", async (event) => {
                    event.preventDefault();

                    hideAlert(errorMessage);
                    hideAlert(successMessage);

                    const name = document.getElementById("name").value.trim();
                    const email = document.getElementById("email").value.trim();
                    const password = document.getElementById("password").value;
                    const confirmPassword = document
                        .getElementById("confirm-password")
                        .value;

                    if (password !== confirmPassword) {
                        showAlert(errorMessage, "Les mots de passe ne correspondent pas.");
                        return;
                    }

                    if (!name) {
                        showAlert(errorMessage, "Merci d'indiquer votre nom complet.");
                        return;
                    }

                    const submitButton = signupForm.querySelector(
                        'button[type="submit"]',
                    );
                    const originalButtonText = submitButton.textContent;

                    submitButton.disabled = true;
                    submitButton.textContent = "Création en cours...";

                    try {
                        await auth.createAccount(email, password, name);
                        showAlert(
                            successMessage,
                            "Compte créé avec succès ! Redirection...",
                        );

                        setTimeout(() => {
                            window.location.href = "profile.html";
                        }, 1200);
                    } catch (error) {
                        showAlert(
                            errorMessage,
                            error?.message ||
                                "Impossible de créer le compte. Veuillez réessayer.",
                        );
                    } finally {
                        submitButton.disabled = false;
                        submitButton.textContent = originalButtonText;
                    }
                });
            });
        </script>
    </body>
</html>